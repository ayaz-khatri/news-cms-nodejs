<div id="admin-content">
    <div class="container">
        <div class="row">
            <div class="col-md-10">
            <h1 class="admin-heading"><i class="fa fa-users"></i> All Users</h1>
            </div>
            <div class="col-md-2">
            <a class="add-new" href="/admin/users/add">Add user</a>
            </div>
            <div class="col-md-12">
                <div id="crudTable"></div>
            <!-- <table class="content-table">
                <thead>
                    <th>S.No.</th>
                    <th>Full Name</th>
                    <th>User Name</th>
                    <th>Role</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </thead>
                <tbody>
                    <tr>
                        <td class='id'>1</td>
                        <td>Ram Sharma</td>
                        <td>ram</td>
                        <td>admin</td>
                        <td class='edit'><a href='update-user.html'><i class='fa fa-edit'></i></a></td>
                        <td class='delete'><a href='delete-user.html'><i class='fa fa-trash-o'></i></a></td>
                    </tr>
                    <tr>
                        <td class='id'>2</td>
                        <td>Shyam Kumar</td>
                        <td>shyam</td>
                        <td>author</td>
                        <td class='edit'><a href='update-user.html'><i class='fa fa-edit'></i></a></td>
                        <td class='delete'><a href='delete-user.html'><i class='fa fa-trash-o'></i></a></td>
                    </tr>
                    <tr>
                        <td class='id'>3</td>
                        <td>Ramesh Kumar</td>
                        <td>ramesh</td>
                        <td>admin</td>
                        <td class='edit'><a href='update-user.html'><i class='fa fa-edit'></i></a></td>
                        <td class='delete'><a href='delete-user.html'><i class='fa fa-trash-o'></i></a></td>
                    </tr>
                    <tr>
                        <td class='id'>4</td>
                        <td>Satish Sharma</td>
                        <td>satish</td>
                        <td>admin</td>
                        <td class='edit'><a href='update-user.html'><i class='fa fa-edit'></i></a></td>
                        <td class='delete'><a href='delete-user.html'><i class='fa fa-trash-o'></i></a></td>
                    </tr>
                </tbody>
            </table> -->
            <!-- <nav>
                <ul class="pagination">
                <li class="page-item disabled">
                    <a class="page-link">Previous</a>
                </li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item active">
                    <a class="page-link" href="#" aria-current="page">2</a>
                </li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#">Next</a>
                </li>
                </ul>
            </nav> -->
            </div>
        </div>
    </div>
</div>

<script src="/js/tabulator.min.js"></script>

<script>
    const tableData =  <%- JSON.stringify(users) %> || [];
    
    var table = new Tabulator("#crudTable", {
        data:tableData,
        layout:"fitColumns",
        pagination:true,
        paginationSize:10,
        paginationSizeSelector:[5, 10, 20, 50],
        columns:[
            {title:"S.No.", formatter:"rownum", width:100, hozAlign:"center"},
            {title:"Full Name", field:"fullname", headerFilter:"input"},
            {title:"User Name", field:"username", headerFilter:"input"},
            {title:"Role", field:"role", headerFilter:"input"},
            {title: "Actions", formatter: function(cell, formatterParams, onRendered){
                return `<a href="/admin/users/update/${cell.getData()._id}" class="btn btn-sm btn-success text-white" title="Edit">Edit</a> 
                <button class="btn btn-sm btn-danger delete" title="Delete" onclick="deleteEntity('${cell.getData()._id}')">Delete</button>`;
            }}
        ],
    });

    async function deleteEntity(id) {
        if (confirm("Are you sure you want to delete this user?")) {
            const response = await fetch(`/admin/users/delete/${id}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Failed to delete user.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while deleting the user.');
            });
        }
    }

</script>

<%- contentFor('tabulatorCSS') %>
<!-- Tabulator CSS -->
<link rel="stylesheet" href="/css/tabulator.min.css" />
<link rel="stylesheet" href="/css/tabulator_bootstrap5.min.css" />