<div id="admin-content">
    <div class="container">
        <div class="row">
            <div class="col-md-10">
                <h1 class="admin-heading"><i class="fa fa-gears"></i> All Categories</h1>
            </div>
            <div class="col-md-2">
                <a class="add-new" href="/admin/categories/add">add category</a>
            </div>
            <div class="col-md-12">
                <div id="crudTable"></div>
            </div>
        </div>
    </div>
</div>

<script src="/js/tabulator.min.js"></script>

<script>
    const tableData =  <%- JSON.stringify(categories) %> || [];
    
    var table = new Tabulator("#crudTable", {
        data:tableData,
        layout:"fitColumns",
        pagination:true,
        paginationSize:10,
        paginationSizeSelector:[5, 10, 20, 50],
        columns:[
            {title:"S.No.", formatter:"rownum", width:100, hozAlign:"center"},
            {title:"Name", field:"name", headerFilter:"input"},
            {title:"Slug", field:"slug", headerFilter:"input"},
            {title: "Actions", formatter: function(cell, formatterParams, onRendered){
                return `<a href="/admin/categories/update/${cell.getData()._id}" class="btn btn-sm btn-success text-white" title="Edit">Edit</a> 
                <button class="btn btn-sm btn-danger delete" title="Delete" onclick="deleteEntity('${cell.getData()._id}')">Delete</button>`;
            }}
        ],
    });

    async function deleteEntity(id) {
        if (confirm("Are you sure you want to delete this category?")) {
            const response = await fetch(`/admin/categories/delete/${id}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Failed to delete category.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while deleting the category.');
            });
        }
    }

</script>

<%- contentFor('tabulatorCSS') %>
<!-- Tabulator CSS -->
<link rel="stylesheet" href="/css/tabulator.min.css" />
<link rel="stylesheet" href="/css/tabulator_bootstrap5.min.css" />